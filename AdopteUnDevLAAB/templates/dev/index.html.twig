{% extends "base.html.twig" %}
{% block stylesheets %}
    <style>
		.bg-overlay{
			background : url('{{ asset('assets/images/user.jpg') }}') ;
		}
		#suggestions {
            max-height: 200px;
            overflow-y: auto;
            position: absolute;
            background: white;
            z-index: 1000;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .suggestion {
            padding: 10px;
            cursor: pointer;
        }
        .suggestion:hover {
            background: #f8f9fa;
        }
	</style>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
    /* Ajustements pour Select2 */
    .select2-container .select2-selection--multiple {
            height: auto !important;
            border: 1px solid #ced4da !important;
            border-radius: 100px !important; 
            padding: 0.375rem !important;
        }
		.technologies .text-muted {
			font-size: 14px;
    		font-weight: 700;
		}
    </style>
    {% endblock %}
    {% block content %}
        <section class="bg-half page-next-level">
            <div class="bg-overlay"></div>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="text-center text-white">
                            <h4 class="text-uppercase title mb-4">
                                Trouver un job
                            </h4>
                            <ul class="page-next d-inline-block mb-0">
                                <li>
                                    <a href="{{ path('app_dashboard') }}" class="text-uppercase font-weight-bold">
                                        Accueil
                                    </a>
                                </li>
                                <li>
                                    <span class="text-uppercase text-white font-weight-bold">
                                        Liste des développeurs
                                    </span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="section">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3">
                        <div class="left-sidebar">
                            <div class="accordion" id="accordionExample">
                                <div class="card rounded">
                                    <a data-toggle="collapse" href="#collapseOne" class="job-list" aria-expanded="true" aria-controls="collapseOne">
                                        <div class="card-header" id="headingOne">
                                            <h6 class="mb-0 text-dark f-18">
                                                Date de publication
                                            </h6>
                                        </div>
                                    </a>
                                    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne">
                                        <div class="card-body p-0">
                                            <div class="custom-control custom-radio">
                                                <input type="radio" id="customRadio1" name="customRadio" class="custom-control-input" />
                                                <label class="custom-control-label ml-1 text-muted" for="customRadio1">
                                                    1 heures
                                                </label>
                                            </div>
                                            <div class="custom-control custom-radio">
                                                <input type="radio" id="customRadio2" name="customRadio" class="custom-control-input input-date" />
                                                <label class="custom-control-label ml-1 text-muted" for="customRadio2">
                                                    24  heures
                                                </label>
                                            </div>
                                            <div class="custom-control custom-radio">
                                                <input type="radio" id="customRadio3" name="customRadio" class="custom-control-input input-date" />
                                                <label class="custom-control-label ml-1 text-muted" for="customRadio3">
                                                    7 derniers jours
                                                </label>
                                            </div>
                                            <div class="custom-control custom-radio">
                                                <input type="radio" id="customRadio4" name="customRadio" class="custom-control-input input-date" />
                                                <label class="custom-control-label ml-1 text-muted" for="customRadio4">
                                                    14 derniers jours
                                                </label>
                                            </div>
                                            <div class="custom-control custom-radio">
                                                <input type="radio" id="customRadio5" name="customRadio" class="custom-control-input input-date" />
                                                <label class="custom-control-label ml-1 text-muted" for="customRadio5">
                                                    30 derniers jours
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- collapse one end -->
                                <div class="card rounded mt-4">
                                    <a data-toggle="collapse" href="#collapsethree" class="job-list" aria-expanded="true" aria-controls="collapsethree">
                                        <div class="card-header" id="headingthree">
                                            <h6 class="mb-0 text-dark f-18">
                                                Année d'expérience
                                            </h6>
                                        </div>
                                    </a>
                                    <div id="collapsethree" class="collapse show" aria-labelledby="headingthree">
                                        <div class="card-body p-0">
                                            <div class="custom-control custom-radio">
                                                <input type="radio" id="customRadio13" name="customRadio2" class="custom-control-input input-experience" />
                                                <label class="custom-control-label ml-1 text-muted f-15" for="customRadio13">
                                                    1 à 3 ans
                                                </label>
                                            </div>
                                            <div class="custom-control custom-radio">
                                                <input type="radio" id="customRadio14" name="customRadio2" class="custom-control-input input-experience" />
                                                <label class="custom-control-label ml-1 text-muted f-15" for="customRadio14">
                                                    3 à 5 ans
                                                </label>
                                            </div>
                                            <div class="custom-control custom-radio">
                                                <input type="radio" id="customRadio15" name="customRadio2" class="custom-control-input input-experience" />
                                                <label class="custom-control-label ml-1 text-muted f-15" for="customRadio15">
                                                    5 to 8 ans
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="col-lg-12">
                                    <div class="rounded">
                                        <div class="">
                                            <form class="">
                                                <div class="row">
                                                    <div class="col-lg-6 col-md-6">
                                                        <div class="registration-form-box">
                                                            <input type="text" id="motCles" name="motCles" class="form-control rounded registration-input-box" placeholder="Mots-clés..." />
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6">
                                                        <div class="form-group app-label">
                                                            <div class="form-button">
                                                                <div class="">
                                                                    <input type="text" id="address-input" name="localisation" class="form-control rounded registration-input-box" placeholder="Localisation" data-display="Category" autocomplete="off" />
                                                                    <div id="suggestions" class="list-group"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="content-job">
                                {% for poste in postes %}
                                    <div class="col-lg-12 pt-2">
                                        <div class="job-list-box border rounded">
                                            <div class="p-3">
                                                <div class="row align-items-center">
                                                    <div class="col-lg-2">
                                                        <div class="company-logo-img">
                                                            <img src="{{ asset('assets/images/featured-job/img-1.png') }}" alt="" class="img-fluid mx-auto d-block" />
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-7 col-md-9">
                                                        <div class="job-list-desc">
                                                            <h6 class="mb-2">
                                                                <a href="#" class="text-dark">
                                                                    {{ poste.poste.titre }}
                                                                </a>
                                                            </h6>
                                                            <p class="text-muted mb-0">
                                                                <i class="mdi mdi-bank mr-2"></i>
                                                                {{ poste.poste.company.raisonSociale }}
                                                            </p>
                                                            <ul class="list-inline mb-0">
                                                                <li class="list-inline-item mr-3">
                                                                    <p class="text-muted mb-0">
                                                                        <i class="mdi mdi-map-marker mr-2"></i>
                                                                        {{ poste.poste.localisation }}
                                                                    </p>
                                                                </li>
                                                                <li class="list-inline-item">
                                                                    <p class="text-smuted mb-0">
                                                                        <i class="mdi mdi-clock-outline mr-2"></i>
                                                                        1 Minute ago
                                                                    </p>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-3 col-md-3">
                                                        <div class="job-list-button-sm text-right">
                                                            <div class="mt-3">
                                                                <a href="{{ path('app_details_poste', {id :poste.poste.id }) }}" class="btn btn-sm btn-primary">
                                                                    Postuler
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    {% endblock %}
    {% block javascripts %}
        <script>
        $(document).ready(function () {
            $('#input-experience').on('click', function(){
                let experienceDebut = $('#userProfile').attr('data-debut');
                let experienceFin = $('#userProfile').attr('data-fin');
            })
            $('#motCles').on('input', function () {
                let motCles = $('#motCles').val();
                let localisation = $('#address-input').val();
                ajaxFindJob(motCles,localisation)
            });
            $('#address-input').on('input', function () {
                let motCles = $('#motCles').val();
                let localisation = $('#address-input').val();
                ajaxFindJob(motCles,localisation)
                
            });    
        });

        function ajaxFindJob(motCles,   localisation){
            $.ajax({
                url: '{{ path('find_job') }}',
                type: 'POST',
                dataType: 'json',
                data: {
                   'mots_cles' : motCles,
                   'localisation': localisation
                },
                success: function (data) {
                    $('#content-job').html("");
                    $('#content-job').html(data.html);
                }
            })
        }
    </script>
        <script>
    const input = document.getElementById('address-input');
    const suggestionsDiv = document.getElementById('suggestions');

    input.addEventListener('input', () => {
        const query = input.value;
        if (query.length > 2) { // Limiter les requêtes inutiles
            fetch(`https://api-adresse.data.gouv.fr/search/?q=${query}`)
                .then(response => response.json())
                .then(data => {
                    // Vider les suggestions
                    suggestionsDiv.innerHTML = '';
                    data.features.forEach(feature => {
                        const div = document.createElement('div');
                        div.classList.add('suggestion', 'list-group-item');
                        div.textContent = feature.properties.label;
                        div.addEventListener('click', () => {
                            input.value = feature.properties.label;
                            suggestionsDiv.innerHTML = ''; // Masquer les suggestions
                        });
                        suggestionsDiv.appendChild(div);
                    });
                });
        } else {
            suggestionsDiv.innerHTML = ''; // Effacer si la saisie est courte
        }
    });

    // Fermer les suggestions si on clique en dehors
    document.addEventListener('click', (e) => {
        if (!suggestionsDiv.contains(e.target) && e.target !== input) {
            suggestionsDiv.innerHTML = '';
        }
    }
    );
</script>
        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Select2 JS -->
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <script>
        $(document).ready(function () {
        // Initialisation de Select2
            $('.js-example-basic-multiple').select2({
                allowClear: true,
                width: 'resolve' 
            });
        });
    </script>
    {% endblock %}
    